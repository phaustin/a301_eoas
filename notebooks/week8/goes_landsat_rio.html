
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>44. Combining goes and landsat data using rioxarray &#8212; ATSC 301</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/week8/goes_landsat_rio';</script>
    <link rel="canonical" href="https://phaustin.github.io/a301_eoas/notebooks/week8/goes_landsat_rio.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="45. Assignment 6" href="../../solutions/assign6.html" />
    <link rel="prev" title="43. Combining goes and landsat data using rioxarray" href="goes_landsat.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">ATSC 301</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    ATSC 301: 2024 Term 2 Winter
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Useful links</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">ATSC 301: syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrity.html">UBC academic integrity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../texts.html">Texts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../assignments.html">A301 Assignments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pixi_install.html">pixi install for macos and windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_install.html">Windows installation using a conda lock file</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/drive/folders/1-Ja2wVKVIjkZb7Gx_rfc14J_aBYiknuw?usp=sharing)">Notebook downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebook_index.html">code snippets by notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Weekly topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week_notes.html">Week notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_review.html">Weekly review</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Midterm</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../midterm/midterm_focus.html">1. Study topics for midterm</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1E6Gs6zUARHdEAb2UqIyMnyXj-jCiOiXw/view?usp=drive_link">2025 mid-term equation sheet</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/12ZDN8NZzgafeCMDTy4t0u-w80o3-foNT/view?usp=sharing">2022 mid-term</a></li>
<li class="toctree-l1"><a class="reference internal" href="../midterm/mid_term_reviewI.html">2. Sample mid-term questions I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../midterm/mid_term_reviewII.html">3. Midterm review questions II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../midterm/mid_term_reviewI_solutions.html">4. Midterm Solutions: midterm sample questions I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../midterm/mid_term_reviewII_solutions.html">5. Midterm solutions: sample questions II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/midterm/a301_2024t2_midterm_solution.html">6. A301 midterm solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://www.eoas.ubc.ca/books/Practical_Meteorology/prmet102/Ch02-radiation-v102b.pdf">Stull Chapter 2, pp. 34-43</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week1/beers_law.html">7. Beers and inverse squared laws</a></li>
<li class="toctree-l1"><a class="reference external" href="https://gw2jh3xr2c.search.serialssolutions.com/?sid=sersol&amp;SS_jc=TC0000517195&amp;title=Atmospheric%20Science%3A%20An%20Introductory%20Survey">Wallace and Hobbs Chapter 4, pp. 113-118</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week1/radiance.html">8. Solid angle and radiance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week1/newflux.html">9. Finding the flux given the radiance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week1/planck_function.html">10. Plotting the Planck function with python</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../week2/planck_sol.html">11. Plotting the Planck function - solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week2/assign1.html">12. Assignment 1, brightness temperatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week2/cartopy_maps.html">13. Introduction to Cartopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week2/cartopy_mapping_vancouver.html">14. Mapping Vancouver with cartopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week2/get_landsat_bands.html">15. Landsat 1: Dowloading Landsat and Sentinel data from NASA</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../week3/map_landsat.html">16. Mapping the landsat scene</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week3/assign1_solution.html">17. Assignment 1, brightness temperatures - solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week3/zoom_landsat.html">18. Zooming an image</a></li>

<li class="toctree-l1"><a class="reference internal" href="../week3/kirchoff.html">20. Kirchoff worksheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week3/optical_depth.html">21. Optical depth and partial transmission</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 4</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../week4/clip_bands.html">22. Clipping multiple bands– v0.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week4/optical_depth2.html">23. Optical depth II: mean free path</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign2_solutionsA.html">24. Assignment 2: solutions Part A</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 5</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign4.html">25. Assignment 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign2_solutionsB.html">26. Assignment 2: solutions part B</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week5/rowcol2latlon.html">27. Getting lat,lon from row, column</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week5/schwartz.html">28. The Schwartzchild Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week5/add_palette.html">29. Adding a palette to an axis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign2_solutionsC.html">30. Assignment 2: solutions part C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week5/hydrostat.html">31. Hydrostatic balance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week5/cartopy_mapping_buenos_aires.html">32. Cartopy mapping Buenos Aires</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 6</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign3_solutions.html">33. Assignment 3: solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week6/hydrostatic_balance.html">34. Scale heights for typical atmospheric soundings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week6/weighting_functions.html">35. Weighting functions for temperature retrieval</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week6/heating_rate.html">36. Finding the heating rate of the atmosphere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week6/assign4_two_layer_sol.html">37. Assignment 4 two layer solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign4_solution.html">38. Assignment 4 solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 7</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../week7/false_color.html">39. Making color composite (“false color”) images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week7/fmask.html">40. Using fmask to mask water pixels</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 8</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="install_part1.html">41. Python packages Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="goes_true_color.html">42. GOES-16: True Color Images from GOES ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="goes_landsat.html">43. Combining goes and landsat data using rioxarray</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">44. Combining goes and landsat data using rioxarray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign6.html">45. Assignment 6</a></li>
<li class="toctree-l1"><a class="reference internal" href="radar.html">46. Notes on the radar equation</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/week8/goes_landsat_rio.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Combining goes and landsat data using rioxarray</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">44.1. Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-original-hls-tif-files-from-disk">44.2. Get the original hls tif files from disk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-band-5-into-a-dictionary">44.3. Read band 5 into a dictionary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-image-point-and-boundary-offsets">44.4. Define the image point and boundary offsets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-bounds-and-clip">44.5. Find bounds and clip</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-goes-image">44.6. Get GOES image</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-landsat-overpass-time">44.6.1. Read the landsat overpass time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-coincident-goes-18-image">44.6.2. Get the coincident GOES 18 image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-image-with-goes2go">44.6.3. Read the image with goes2go</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-that-the-goes-coordinates-are-not-in-meters">44.6.3.1. Note that the GOES coordinates are not in meters</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-veggie-band-c03-nir">44.6.4. Get the veggie band (C03, nir)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-affine-transform">44.6.5. create the affine transform</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-make-new-rioxarray">44.6.6. Define make_new_rioxarray</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-make-new-rioxarray-to-transform-c3-into-a-rioxarray">44.6.7. Use make_new_rioxarray to transform c3 into a rioxarray</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-full-extent-of-the-goes-scene">44.6.8. Get the full extent of the GOES scene</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-goes-rioxarray">44.6.9. Plot the goes rioxarray</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#now-clip-the-goes-image-to-landsat-bounds">44.7. Now clip the GOES image to Landsat bounds</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transform-the-landsat-bounds-to-goes-coords">44.7.1. Transform the landsat bounds to GOES coords</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verdict-clipped-regions-still-mismatched">44.8. Verdict: clipped regions still mismatched</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-cropped-goes-image">44.8.1. Plot the cropped goes image</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-solution-resampling">44.9. The solution: resampling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-resampled-image">44.9.1. Plot the resampled image</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">44.10. Summary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="combining-goes-and-landsat-data-using-rioxarray">
<span id="week8-goes-landsat-rio"></span><h1><span class="section-number">44. </span>Combining goes and landsat data using rioxarray<a class="headerlink" href="#combining-goes-and-landsat-data-using-rioxarray" title="Link to this heading">#</a></h1>
<p>This is a continuation of <a class="reference internal" href="goes_landsat.html#week8-goes-landsat"><span class="std std-ref">Combining goes and landsat data using rioxarray</span></a>.  We’ll switch back from satpy to
goes2go to read in the GOES image, then clip it using <code class="docutils literal notranslate"><span class="pre">rio.clip_box</span></code>.</p>
<p>The question:  Does <code class="docutils literal notranslate"><span class="pre">rio.clip_box</span></code> give us a better match than <code class="docutils literal notranslate"><span class="pre">satpy.crop</span></code> for the Landsat 30 km x 24 km bounding box? If not, can we figure out why? The first part of the notebook is identical to the the Landsat section of <a class="reference internal" href="goes_landsat.html#landsat-goes-find-bounds"><span class="std std-ref">Find bounds and clip</span></a>.  The GOES section
switches to goes2go to get an xarray file instead of a satpy scene object, and then
turns the xarray DataArray into a rio.DataArray by adding the GOES crs and affine transform.</p>
<p>Finally, I use <a class="reference external" href="https://corteva.github.io/rioxarray/stable/examples/reproject_match.html">rio.reproject_match</a> to resample the
GOES image to the exact 30 meter Landsat grid, which forces and exact match with the Landsat
bounding box.</p>
<section id="installation">
<h2><span class="section-number">44.1. </span>Installation<a class="headerlink" href="#installation" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>I’ve updated <a class="reference external" href="https://github.com/phaustin/a301_lib/blob/main/src/a301_lib.py">a301_lib.py</a> to include the data structures and the <code class="docutils literal notranslate"><span class="pre">find_bounds</span></code> function from <a class="reference internal" href="goes_landsat.html#week8-goes-landsat"><span class="std std-ref">Combining goes and landsat data using rioxarray</span></a>.  You’ll need to reinstall the library with:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span> <span class="o">--</span><span class="n">upgrade</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Download goes_landsat_rio.ipynb from the <a class="reference external" href="https://drive.google.com/drive/folders/1-Ja2wVKVIjkZb7Gx_rfc14J_aBYiknuw?usp=sharing">week8 folder</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyproj</span><span class="w"> </span><span class="kn">import</span> <span class="n">CRS</span><span class="p">,</span> <span class="n">Transformer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rioxarray</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cartopy</span><span class="w"> </span><span class="kn">import</span> <span class="n">crs</span> <span class="k">as</span> <span class="n">ccrs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">a301_lib</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">make_pal</span><span class="p">,</span>
    <span class="n">Row_col_offsets</span><span class="p">,</span>
    <span class="n">Clip_point</span><span class="p">,</span>
    <span class="n">Bounding_box</span><span class="p">,</span>
    <span class="n">Cartopy_extent</span><span class="p">,</span>
    <span class="n">find_bounds</span>
    <span class="p">)</span>
    
<span class="kn">import</span><span class="w"> </span><span class="nn">pyproj</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pydantic</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">goes2go.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">goes_nearesttime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">affine</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/phil/mini310/envs/a301/lib/python3.13/site-packages/goes2go/data.py:673: FutureWarning: &#39;H&#39; is deprecated and will be removed in a future version. Please use &#39;h&#39; instead of &#39;H&#39;.
  within=pd.to_timedelta(config[&quot;nearesttime&quot;].get(&quot;within&quot;, &quot;1h&quot;)),
/Users/phil/mini310/envs/a301/lib/python3.13/site-packages/goes2go/NEW.py:185: FutureWarning: &#39;H&#39; is deprecated and will be removed in a future version. Please use &#39;h&#39; instead of &#39;H&#39;.
  within=pd.to_timedelta(config[&quot;nearesttime&quot;].get(&quot;within&quot;, &quot;1h&quot;)),
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-the-original-hls-tif-files-from-disk">
<h2><span class="section-number">44.2. </span>Get the original hls tif files from disk<a class="headerlink" href="#get-the-original-hls-tif-files-from-disk" title="Link to this heading">#</a></h2>
<p>This cell finds all the 3660 x 3660 landsat tifs we downloaded in the satdata/landsat/vancouver folder.  We can use the <code class="docutils literal notranslate"><span class="pre">*</span></code> wildcard
so we don’t have to type in long filenames, and the <code class="docutils literal notranslate"><span class="pre">**</span></code> wildcard so we look in all subfolders.  If you’re interested  here’s
the <a class="reference external" href="https://en.wikipedia.org/wiki/Glob_(programming)#:~:text=6%20References-,Origin,command%3A%20%2Fetc%2Fglob.">wikipedia entry on globbing</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;repos/a301/satdata/landsat&#39;</span>
<span class="n">the_tifs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;**/vancouver_2023/HLS.L30*tif&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">the_tifs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[PosixPath(&#39;/Users/phil/repos/a301/satdata/landsat/vancouver_2023/HLS.L30.T10UDV.2023226T190707.v2.0.Fmask.tif&#39;), PosixPath(&#39;/Users/phil/repos/a301/satdata/landsat/vancouver_2023/HLS.L30.T10UDV.2023226T190707.v2.0.B05.tif&#39;)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-band-5-into-a-dictionary">
<h2><span class="section-number">44.3. </span>Read band 5 into a dictionary<a class="headerlink" href="#read-band-5-into-a-dictionary" title="Link to this heading">#</a></h2>
<p>Note on the next cell:</p>
<ul class="simple">
<li><p>Because we set <code class="docutils literal notranslate"><span class="pre">masked_and_scale=True</span></code>, all <code class="docutils literal notranslate"><span class="pre">-9999</span></code> values are changed to <code class="docutils literal notranslate"><span class="pre">np.nan</span></code> and the data is multiplied by the scale factor and converted from <code class="docutils literal notranslate"><span class="pre">int16</span></code> to <code class="docutils literal notranslate"><span class="pre">float32</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">band_dict</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">tif_path</span> <span class="ow">in</span> <span class="n">the_tifs</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;Fmask&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">tif_path</span><span class="p">):</span>
        <span class="n">hls_band</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">tif_path</span><span class="p">,</span>
                                           <span class="n">mask_and_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">band_name</span> <span class="o">=</span> <span class="s1">&#39;fmask&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hls_band</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">tif_path</span><span class="p">,</span>
                                           <span class="n">mask_and_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">band_name</span> <span class="o">=</span> <span class="n">hls_band</span><span class="o">.</span><span class="n">long_name</span>
    <span class="n">hls_band</span> <span class="o">=</span> <span class="n">hls_band</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band_name</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">band_dict</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">hls_band</span>
    <span class="k">if</span> <span class="s1">&#39;unit&#39;</span> <span class="ow">in</span> <span class="n">hls_band</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hls_band</span><span class="o">.</span><span class="n">unit</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>band_name=&#39;fmask&#39;
band_name=&#39;NIR&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">landsat_nir</span> <span class="o">=</span> <span class="n">band_dict</span><span class="p">[</span><span class="s1">&#39;NIR&#39;</span><span class="p">]</span>
<span class="n">landsat_crs</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">(</span><span class="n">landsat_nir</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">pal_dict</span> <span class="o">=</span> <span class="n">make_pal</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">landsat_nir</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">norm</span> <span class="o">=</span> <span class="n">pal_dict</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">],</span>
                    <span class="n">cmap</span> <span class="o">=</span> <span class="n">pal_dict</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span>
                    <span class="n">extend</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/193dd53f283db732e8bd9241437bb751d643ad0ba69a9ad567711d233a923eb1.png" src="../../_images/193dd53f283db732e8bd9241437bb751d643ad0ba69a9ad567711d233a923eb1.png" />
</div>
</div>
</section>
<section id="define-the-image-point-and-boundary-offsets">
<h2><span class="section-number">44.4. </span>Define the image point and boundary offsets<a class="headerlink" href="#define-the-image-point-and-boundary-offsets" title="Link to this heading">#</a></h2>
<p>To make the bounding box, we add column and row offsets
to a point that we want in our image, in this case EOSC</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ubc_lon</span> <span class="o">=</span> <span class="o">-</span><span class="mf">123.2460</span> <span class="c1">#degrees West</span>
<span class="n">ubc_lat</span> <span class="o">=</span> <span class="mf">49.2606</span>  <span class="c1"># degrees North</span>
<span class="n">image_point</span> <span class="o">=</span> <span class="n">Clip_point</span><span class="p">(</span><span class="n">lon</span> <span class="o">=</span> <span class="n">ubc_lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">ubc_lat</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># remember that rows increase downwards</span>
<span class="c1"># make a 1000 row by 800 column (30 km x 24 km) clipped image</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="n">offsets</span> <span class="o">=</span> <span class="n">Row_col_offsets</span><span class="p">(</span><span class="n">west</span> <span class="o">=</span> <span class="o">-</span><span class="mi">500</span><span class="p">,</span>
                <span class="n">south</span> <span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                <span class="n">east</span> <span class="o">=</span>  <span class="mi">300</span><span class="p">,</span>
                <span class="n">north</span> <span class="o">=</span> <span class="o">-</span><span class="mi">700</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-bounds-and-clip">
<h2><span class="section-number">44.5. </span>Find bounds and clip<a class="headerlink" href="#find-bounds-and-clip" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">landsat_bbox</span> <span class="o">=</span> <span class="n">find_bounds</span><span class="p">(</span><span class="n">landsat_nir</span><span class="p">,</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">image_point</span><span class="p">,</span> <span class="n">scene_crs</span> <span class="o">=</span> <span class="n">landsat_crs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">landsat_bbox</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xmin=467100.0 ymin=5447460.0 xmax=491100.0 ymax=5477460.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bounds_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">landsat_bbox</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">clipped_landsat</span> <span class="o">=</span> <span class="n">landsat_nir</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip_box</span><span class="p">(</span><span class="o">*</span><span class="n">bounds_list</span><span class="p">)</span>
<span class="n">clipped_landsat</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1000, 800)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">clipped_landsat</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">norm</span> <span class="o">=</span> <span class="n">pal_dict</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">],</span>
                    <span class="n">cmap</span> <span class="o">=</span> <span class="n">pal_dict</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span>
                    <span class="n">extend</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3da778292ac9c367dcf8902430932a8c74e8589e59aab8622129544f9e2be68f.png" src="../../_images/3da778292ac9c367dcf8902430932a8c74e8589e59aab8622129544f9e2be68f.png" />
</div>
</div>
</section>
<section id="get-goes-image">
<h2><span class="section-number">44.6. </span>Get GOES image<a class="headerlink" href="#get-goes-image" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">save_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;repos/a301/satdata/goes&quot;</span> 
</pre></div>
</div>
</div>
</div>
<section id="read-the-landsat-overpass-time">
<h3><span class="section-number">44.6.1. </span>Read the landsat overpass time<a class="headerlink" href="#read-the-landsat-overpass-time" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">landsat_nir</span><span class="o">.</span><span class="n">SENSING_TIME</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2023-08-14T19:07:07.6421900Z; 2023-08-14T19:07:31.5247580Z&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-the-coincident-goes-18-image">
<h3><span class="section-number">44.6.2. </span>Get the coincident GOES 18 image<a class="headerlink" href="#get-the-coincident-goes-18-image" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">getdata</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <span class="n">getdata</span><span class="p">:</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">goes_nearesttime</span><span class="p">(</span>
        <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">19</span><span class="p">),</span> <span class="n">satellite</span><span class="o">=</span><span class="s2">&quot;goes18&quot;</span><span class="p">,</span><span class="n">product</span><span class="o">=</span><span class="s2">&quot;ABI-L2-MCMIP&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> 
          <span class="n">return_as</span><span class="o">=</span><span class="s2">&quot;xarray&quot;</span><span class="p">,</span> <span class="n">save_dir</span> <span class="o">=</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">download</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">the_path</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">the_path</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;noaa-goes18/ABI-L2-MCMIPC/2023/236/19/&quot;</span>
                <span class="s2">&quot;OR_ABI-L2-MCMIPC-M6_G18_s20232361901177&quot;</span>
                <span class="s2">&quot;_e20232361903550_c20232361904064.nc&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_path</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">/</span> <span class="n">the_path</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-the-image-with-goes2go">
<h3><span class="section-number">44.6.3. </span>Read the image with goes2go<a class="headerlink" href="#read-the-image-with-goes2go" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">goesC</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">mask_and_scale</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="note-that-the-goes-coordinates-are-not-in-meters">
<h4><span class="section-number">44.6.3.1. </span>Note that the GOES coordinates are not in meters<a class="headerlink" href="#note-that-the-goes-coordinates-are-not-in-meters" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GOES x distance </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">goesC</span><span class="o">.</span><span class="n">x</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GOES x distance [5.5998564e-05 5.6002289e-05 5.6006014e-05 5.6013465e-05]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="get-the-veggie-band-c03-nir">
<h3><span class="section-number">44.6.4. </span>Get the veggie band (C03, nir)<a class="headerlink" href="#get-the-veggie-band-c03-nir" title="Link to this heading">#</a></h3>
<p>Note that the channel 3 coordinates are now in meters.  This is because the
pixel size depends on the channel.  The size is larger for the thermal
channels.  Note that also that the navigation is a little more variable
than it was in satpy, where thee pixel sizes only differed in the
fifth decimal place, not the first.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c3</span> <span class="o">=</span> <span class="n">goesC</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">parse_cf</span><span class="p">(</span><span class="s1">&#39;CMI_C03&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GOES x distance </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">x</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GOES x distance [2003.96589091 2004.09920424 2004.23251756 2004.49914421]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cartopy_crs</span> <span class="o">=</span> <span class="n">c3</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">cartopy_crs</span>
<span class="n">goes_crs</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">(</span><span class="n">cartopy_crs</span><span class="p">)</span>
<span class="n">goes_coords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
<span class="n">goes_dims</span> <span class="o">=</span> <span class="n">c3</span><span class="o">.</span><span class="n">dims</span>
<span class="c1">#</span>
<span class="c1"># use average pixel size for the transform</span>
<span class="c1">#</span>
<span class="n">resolutionx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
<span class="n">resolutiony</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="n">missing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">resolutionx</span><span class="p">,</span><span class="w"> </span><span class="n">resolutiony</span><span class="p">)</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="n">c3</span><span class="o">.</span><span class="n">attrs</span>
<span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;valid_range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
<span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;missing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(resolutionx, resolutiony)=(np.float64(2004.017317102528), np.float64(-2004.017295251391))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c3</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5b1c46b41a4dbb681519e0802b4c86eb3b1905de4654a7230de87ebc2d038335.png" src="../../_images/5b1c46b41a4dbb681519e0802b4c86eb3b1905de4654a7230de87ebc2d038335.png" />
</div>
</div>
</section>
<section id="create-the-affine-transform">
<h3><span class="section-number">44.6.5. </span>create the affine transform<a class="headerlink" href="#create-the-affine-transform" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ul_x</span> <span class="o">=</span> <span class="n">c3</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">ul_y</span> <span class="o">=</span> <span class="n">c3</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">lr_x</span> <span class="o">=</span> <span class="n">c3</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">lr_y</span> <span class="o">=</span> <span class="n">c3</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">goes_transform</span> <span class="o">=</span> <span class="n">affine</span><span class="o">.</span><span class="n">Affine</span><span class="p">(</span><span class="n">resolutionx</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ul_x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">resolutiony</span><span class="p">,</span> <span class="n">ul_y</span><span class="p">)</span>
<span class="n">goes_transform</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Affine(np.float64(2004.017317102528), 0.0, np.float64(-2504019.637719609),
       0.0, np.float64(-2004.017295251391), np.float64(4588197.756226748))
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-make-new-rioxarray">
<h3><span class="section-number">44.6.6. </span>Define make_new_rioxarray<a class="headerlink" href="#define-make-new-rioxarray" title="Link to this heading">#</a></h3>
<p>This function assembles a rioxarray from numpy data plus
all the necessary metadata.  There are 2 steps:</p>
<ol class="arabic simple">
<li><p>Create an <a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.DataArray.html">xarray.DataArray</a> with
data, coords, dims, optional attributes and a name (defaults to <code class="docutils literal notranslate"><span class="pre">name_here</span></code>)</p></li>
<li><p>add the rioxarray metdata: crs, transform and optional missing value</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">make_new_rioxarray</span><span class="p">(</span>
    <span class="n">rawdata</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">coords</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">dims</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
    <span class="n">crs</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">,</span>
    <span class="n">transform</span><span class="p">:</span> <span class="n">affine</span><span class="o">.</span><span class="n">Affine</span><span class="p">,</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">missing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;name_here&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    create a new rioxarray from an ndarray plus components</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    rawdata: numpy array</span>
<span class="sd">    crs: pyproj crs for scene</span>
<span class="sd">    coords: xarray coordinate dict</span>
<span class="sd">    dims: x and y dimension names from coorcds</span>
<span class="sd">    transform: scene affine transform</span>
<span class="sd">    attrs: optional attribute dictionary</span>
<span class="sd">    missing: optional missing value</span>
<span class="sd">    name: optional variable name, defaults to &quot;name_here&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    rio_da: a new rioxarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rio_da</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">rawdata</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span>
                            <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">rio_da</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">rio_da</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_transform</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rio_da</span><span class="o">=</span><span class="n">rio_da</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rio_da</span> <span class="o">=</span> <span class="n">rio_da</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">set_nodata</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rio_da</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="use-make-new-rioxarray-to-transform-c3-into-a-rioxarray">
<h3><span class="section-number">44.6.7. </span>Use make_new_rioxarray to transform c3 into a rioxarray<a class="headerlink" href="#use-make-new-rioxarray-to-transform-c3-into-a-rioxarray" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">goes_c3</span> <span class="o">=</span> <span class="n">make_new_rioxarray</span><span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">goes_coords</span><span class="p">,</span> <span class="n">goes_dims</span><span class="p">,</span> 
                    <span class="n">goes_crs</span><span class="p">,</span> <span class="n">goes_transform</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">missing</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">goes_c3</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>name_here
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-the-full-extent-of-the-goes-scene">
<h3><span class="section-number">44.6.8. </span>Get the full extent of the GOES scene<a class="headerlink" href="#get-the-full-extent-of-the-goes-scene" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">goes_c3</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">transform_bounds</span><span class="p">(</span><span class="n">goes_crs</span><span class="p">)</span>
<span class="n">goes_extent</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span>
<span class="n">goes_extent</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-2505021.64637816, 2505021.64637816, 1583173.8219972872, 4589199.764874374)
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-the-goes-rioxarray">
<h3><span class="section-number">44.6.9. </span>Plot the goes rioxarray<a class="headerlink" href="#plot-the-goes-rioxarray" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">lc</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span> <span class="o">-</span><span class="mi">137</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">lc</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">goes_c3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span>
    <span class="n">extent</span><span class="o">=</span> <span class="n">goes_extent</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">cartopy_crs</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">vmin</span> <span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">170</span><span class="p">,</span> <span class="o">-</span><span class="mi">110</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">55</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;50m&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">STATES</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5720e9c06e89dec15106a0a698101a3ded3c34f5465deea2e34a93c98f848909.png" src="../../_images/5720e9c06e89dec15106a0a698101a3ded3c34f5465deea2e34a93c98f848909.png" />
</div>
</div>
</section>
</section>
<section id="now-clip-the-goes-image-to-landsat-bounds">
<h2><span class="section-number">44.7. </span>Now clip the GOES image to Landsat bounds<a class="headerlink" href="#now-clip-the-goes-image-to-landsat-bounds" title="Link to this heading">#</a></h2>
<section id="transform-the-landsat-bounds-to-goes-coords">
<h3><span class="section-number">44.7.1. </span>Transform the landsat bounds to GOES coords<a class="headerlink" href="#transform-the-landsat-bounds-to-goes-coords" title="Link to this heading">#</a></h3>
<p>We what to clip to the same region as our clipped landsat scene.  Note
that we still wind up with a shrunken image with the wrong aspec ration</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clipped_landsat</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1000, 800)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">clipped_landsat</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">xmax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">xmin</span><span class="p">)</span><span class="si">=}</span><span class="s2"> m&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">ymax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ymin</span><span class="p">)</span><span class="si">=}</span><span class="s2"> m&quot;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># transform bounds from landsat to goes crs</span>
<span class="c1">#</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="n">landsat_crs</span><span class="p">,</span> <span class="n">goes_crs</span><span class="p">)</span>
<span class="n">xmin_goes</span><span class="p">,</span><span class="n">ymin_goes</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">)</span>
<span class="n">xmax_goes</span><span class="p">,</span><span class="n">ymax_goes</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">xmax_goes</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">xmin_goes</span><span class="p">)</span><span class="si">=}</span><span class="s2"> m&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">ymax_goes</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ymin_goes</span><span class="p">)</span><span class="si">=}</span><span class="s2"> m&quot;</span><span class="p">)</span>
<span class="n">bounds_goes</span> <span class="o">=</span> <span class="n">xmin_goes</span><span class="p">,</span><span class="n">ymin_goes</span><span class="p">,</span><span class="n">xmax_goes</span><span class="p">,</span><span class="n">ymax_goes</span>
<span class="c1">#</span>
<span class="c1"># now crop to these bounds using clip_box</span>
<span class="c1">#</span>
<span class="n">clipped_c3</span><span class="o">=</span><span class="n">goes_c3</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip_box</span><span class="p">(</span><span class="o">*</span><span class="n">bounds_goes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(xmax - xmin)=24000.0 m
(ymax - ymin)=30000.0 m
(xmax_goes - xmin_goes)=15851.845468400046 m
(ymax_goes - ymin_goes)=14886.105393704027 m
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="verdict-clipped-regions-still-mismatched">
<h2><span class="section-number">44.8. </span>Verdict: clipped regions still mismatched<a class="headerlink" href="#verdict-clipped-regions-still-mismatched" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">rio.clip_box</span></code> gives us exactly the same result as satpy.crop in <a class="reference internal" href="goes_landsat.html#week8-goes-landsat"><span class="std std-ref">Combining goes and landsat data using rioxarray</span></a>: the landsat image is 30 km x 24 km and the cropped GOES image is
only 16 km x 18 km and GOES covers only part of the landsat boundary box.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">clipped_c3</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="w"> </span><span class="n">clipped_landsat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(clipped_c3.shape, clipped_landsat.shape)=((8, 9), (1000, 800))
</pre></div>
</div>
</div>
</div>
<section id="plot-the-cropped-goes-image">
<h3><span class="section-number">44.8.1. </span>Plot the cropped goes image<a class="headerlink" href="#plot-the-cropped-goes-image" title="Link to this heading">#</a></h3>
<p>As the plot below shows, it’s an exact match for the result from the last notebook. Note
how much loser the  GOES band 3 reflectivity is than the Landsat band 5 reflectivity above.
That’s because the big GOES pixels contain more mixtures of urban and rural land.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">extent_cartopy</span> <span class="o">=</span> <span class="n">xmin_goes</span><span class="p">,</span><span class="n">xmax_goes</span><span class="p">,</span><span class="n">ymin_goes</span><span class="p">,</span><span class="n">ymax_goes</span>
<span class="n">fig2</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> 
                        <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">cartopy_crs</span><span class="p">})</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">clipped_c3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span>
    <span class="n">extent</span><span class="o">=</span><span class="n">extent_cartopy</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">cartopy_crs</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mf">0.2</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">extent_cartopy</span><span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="n">cartopy_crs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">GSHHSFeature</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> 
                                            <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c2bbd0fa6ad984a986c2850a00cb7d4bfdc57e8be05e3d9eff6928c7aba00089.png" src="../../_images/c2bbd0fa6ad984a986c2850a00cb7d4bfdc57e8be05e3d9eff6928c7aba00089.png" />
</div>
</div>
</section>
</section>
<section id="the-solution-resampling">
<h2><span class="section-number">44.9. </span>The solution: resampling<a class="headerlink" href="#the-solution-resampling" title="Link to this heading">#</a></h2>
<p>Resample the GOES image to the Landsat grid gives us aa pixel by pixel comparison that shows
why the two domains look different.
We use <a class="reference external" href="https://corteva.github.io/rioxarray/stable/examples/reproject_match.html">rio.reproject_match</a> to resample the
course goes image onto the 1000 x 800 Landsat domain.  Every GOES pixel now has exactly the
same geographic location as every Landsat pixel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">matched_ds</span> <span class="o">=</span> <span class="n">clipped_c3</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">reproject_match</span><span class="p">(</span><span class="n">clipped_landsat</span><span class="p">)</span>
<span class="n">matched_ds</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1000, 800)
</pre></div>
</div>
</div>
</div>
<section id="plot-the-resampled-image">
<h3><span class="section-number">44.9.1. </span>Plot the resampled image<a class="headerlink" href="#plot-the-resampled-image" title="Link to this heading">#</a></h3>
<p>The resampled image shows what the problem was:  the GOES crs is actually tilted with respect
to the zone 10N UTM north-south coordinates, so there’s no way to fit the GOES image into
the Landsat bounding box without resampling.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsg_code</span> <span class="o">=</span> <span class="n">matched_ds</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span>
<span class="n">cartopy_crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">epsg</span><span class="p">(</span><span class="n">epsg_code</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xmin_match</span><span class="p">,</span><span class="n">ymin_match</span><span class="p">,</span><span class="n">xmax_match</span><span class="p">,</span><span class="n">ymax_match</span> <span class="o">=</span> <span class="n">matched_ds</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>
<span class="n">extent_cartopy</span> <span class="o">=</span> <span class="n">xmin_match</span><span class="p">,</span><span class="n">xmax_match</span><span class="p">,</span><span class="n">ymin_match</span><span class="p">,</span><span class="n">ymax_match</span>
<span class="n">fig2</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> 
                        <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">cartopy_crs</span><span class="p">})</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">extent_cartopy</span><span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="n">cartopy_crs</span><span class="p">)</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">matched_ds</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span>
    <span class="n">extent</span><span class="o">=</span><span class="n">extent_cartopy</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">cartopy_crs</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mf">0.2</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">GSHHSFeature</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> 
                                            <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/784c5509c2cc0a4606853709e4c001faf82535dedb6ed26da26ecf71b166ed4b.png" src="../../_images/784c5509c2cc0a4606853709e4c001faf82535dedb6ed26da26ecf71b166ed4b.png" />
</div>
</div>
</section>
</section>
<section id="summary">
<h2><span class="section-number">44.10. </span>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>If we want to fill the entire landsat clipped area with GOES data, we’re going to need to
increase the size of the GOES bounding box in the east and west directions to make up
for the tilt in the coordinate reference system.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/week8"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="goes_landsat.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">43. </span>Combining goes and landsat data using rioxarray</p>
      </div>
    </a>
    <a class="right-next"
       href="../../solutions/assign6.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">45. </span>Assignment 6</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">44.1. Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-original-hls-tif-files-from-disk">44.2. Get the original hls tif files from disk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-band-5-into-a-dictionary">44.3. Read band 5 into a dictionary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-image-point-and-boundary-offsets">44.4. Define the image point and boundary offsets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-bounds-and-clip">44.5. Find bounds and clip</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-goes-image">44.6. Get GOES image</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-landsat-overpass-time">44.6.1. Read the landsat overpass time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-coincident-goes-18-image">44.6.2. Get the coincident GOES 18 image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-image-with-goes2go">44.6.3. Read the image with goes2go</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-that-the-goes-coordinates-are-not-in-meters">44.6.3.1. Note that the GOES coordinates are not in meters</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-veggie-band-c03-nir">44.6.4. Get the veggie band (C03, nir)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-affine-transform">44.6.5. create the affine transform</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-make-new-rioxarray">44.6.6. Define make_new_rioxarray</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-make-new-rioxarray-to-transform-c3-into-a-rioxarray">44.6.7. Use make_new_rioxarray to transform c3 into a rioxarray</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-full-extent-of-the-goes-scene">44.6.8. Get the full extent of the GOES scene</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-goes-rioxarray">44.6.9. Plot the goes rioxarray</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#now-clip-the-goes-image-to-landsat-bounds">44.7. Now clip the GOES image to Landsat bounds</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transform-the-landsat-bounds-to-goes-coords">44.7.1. Transform the landsat bounds to GOES coords</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verdict-clipped-regions-still-mismatched">44.8. Verdict: clipped regions still mismatched</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-cropped-goes-image">44.8.1. Plot the cropped goes image</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-solution-resampling">44.9. The solution: resampling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-resampled-image">44.9.1. Plot the resampled image</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">44.10. Summary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Philip Austin
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>