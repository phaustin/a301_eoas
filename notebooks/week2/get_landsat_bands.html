
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>13. Landsat 1: Dowloading Landsat and Sentinel data from NASA &#8212; ATSC 301</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/week2/get_landsat_bands';</script>
    <link rel="canonical" href="https://phaustin.github.io/a301_eoas/notebooks/week2/get_landsat_bands.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="14. Mapping the landsat scene" href="../week3/map_landsat.html" />
    <link rel="prev" title="12. Mapping Vancouver with cartopy" href="cartopy_mapping_vancouver.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">ATSC 301</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    ATSC 301: 2024 Term 2 Winter
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Useful links</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">ATSC 301: syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrity.html">UBC academic integrity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../texts.html">Texts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../assignments.html">A301 Assignments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pixi_install.html">pixi install for macos and windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_install.html">Windows installation using a conda lock file</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/drive/folders/1-Ja2wVKVIjkZb7Gx_rfc14J_aBYiknuw?usp=sharing)">Notebook downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebook_index.html">code snippets by notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Weekly topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week_notes.html">Week notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_review.html">Weekly review</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Midterm</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1UbgglndY2kneFKL4ogSTLORaaRgnz3B6/view?usp=sharing">2020 mid-term equation sheet</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/12ZDN8NZzgafeCMDTy4t0u-w80o3-foNT/view?usp=sharing">2022 mid-term</a></li>
<li class="toctree-l1"><a class="reference internal" href="../midterm/mid_term_reviewI.html">1. Sample mid-term questions I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../midterm/mid_term_reviewII.html">2. Midterm review questions II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../midterm/mid_term_reviewI_solutions.html">3. Midterm Solutions: midterm sample questions I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../midterm/mid_term_reviewII_solutions.html">4. Midterm solutions: sample questions II</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://www.eoas.ubc.ca/books/Practical_Meteorology/prmet102/Ch02-radiation-v102b.pdf">Stull Chapter 2, pp. 34-43</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week1/beers_law.html">5. Beers and inverse squared laws</a></li>
<li class="toctree-l1"><a class="reference external" href="https://gw2jh3xr2c.search.serialssolutions.com/?sid=sersol&amp;SS_jc=TC0000517195&amp;title=Atmospheric%20Science%3A%20An%20Introductory%20Survey">Wallace and Hobbs Chapter 4, pp. 113-118</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week1/radiance.html">6. Solid angle and radiance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week1/newflux.html">7. Finding the flux given the radiance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week1/planck_function.html">8. Plotting the Planck function with python</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 2</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="planck_sol.html">9. Plotting the Planck function - solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="assign1.html">10. Assignment 1, brightness temperatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="cartopy_maps.html">11. Introduction to Cartopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="cartopy_mapping_vancouver.html">12. Mapping Vancouver with cartopy</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">13. Landsat 1: Dowloading Landsat and Sentinel data from NASA</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../week3/map_landsat.html">14. Mapping the landsat scene</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week3/assign1_solution.html">15. Assignment 1, brightness temperatures - solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week3/zoom_landsat.html">16. Zooming an image</a></li>

<li class="toctree-l1"><a class="reference internal" href="../week3/kirchoff.html">18. Kirchoff worksheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week3/optical_depth.html">19. Optical depth and partial transmission</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 4</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../week4/clip_bands.html">20. Clipping multiple bands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week4/optical_depth2.html">21. Optical depth II: mean free path</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign2_solutionsA.html">22. Assignment 2: solutions Part A</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 5</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign4.html">23. Assignment 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign2_solutionsB.html">24. Assignment 2: solutions part B</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week5/rowcol2latlon.html">25. Getting lat,lon from row, column</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week5/schwartz.html">26. The Schwartzchild Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week5/add_palette.html">27. Adding a palette to an axis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign2_solutionsC.html">28. Assignment 2: solutions part C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week5/hydrostat.html">29. Hydrostatic balance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week5/cartopy_mapping_buenos_aires.html">30. Cartopy mapping Buenos Aires</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 6</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../solutions/assign3_solutions.html">31. Assignment 3: solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week6/hydrostatic_balance.html">32. Scale heights for typical atmospheric soundings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week6/weighting_functions.html">33. Weighting functions for temperature retrieval</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week6/heating_rate.html">34. Finding the heating rate of the atmosphere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week6/assign4_two_layer_sol.html">35. Assignment 4 two layer solution</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/week2/get_landsat_bands.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Landsat 1: Dowloading Landsat and Sentinel data from NASA</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">13.1. Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview-objectives">13.2. Overview/objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">13.3. Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#authentication">13.4. Authentication</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#doing-an-image-search-using-pystac-client">13.5. Doing an image search using pystac_client</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-the-search">13.5.1. set up the search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-metadata-for-search-items">13.5.2. get the metadata for search items</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-assets-for-scene-1-june-14-2015">13.5.3. Get the assets for scene 1 (June 14, 2015)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-display-the-true-color-browse-image">13.5.4. Download and display the true-color browse image</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-the-band5-geotiff">13.6. Working with the Band5 geotiff</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-the-cookie-file-name-as-an-environmental-variable">13.6.1. set the cookie file name as an environmental variable</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-band-5-raster">13.6.2. Read the band 5 raster</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-local-file-if-available">13.6.2.1. Use a local file if available</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#list-all-attributes">13.6.3. List all attributes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-readable-crs">13.6.4. Machine readable crs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#image-coverage">13.6.5. Image  coverage</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#explain-why-the-two-estimates-are-correct-but-different">13.6.5.1. Explain why the two estimates are correct but different.</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling-the-image">13.6.6. Scaling the image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram-the-raster">13.6.7. Histogram the raster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-it-using-a-grey-palette">13.6.8. Plot it using a grey palette</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#write-out-the-raster-as-a-geotiff">13.6.9. Write out the raster as a geotiff</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-next">13.7. What’s next</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-monday-s-class">13.7.1. For Monday’s class</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="landsat-1-dowloading-landsat-and-sentinel-data-from-nasa">
<span id="week2-hls"></span><h1><span class="section-number">13. </span>Landsat 1: Dowloading Landsat and Sentinel data from NASA<a class="headerlink" href="#landsat-1-dowloading-landsat-and-sentinel-data-from-nasa" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Download get_landsat_bands.ipynb from the <a class="reference external" href="https://drive.google.com/drive/folders/1-Ja2wVKVIjkZb7Gx_rfc14J_aBYiknuw?usp=sharing">week2 folder</a></p></li>
</ul>
<section id="introduction">
<h2><span class="section-number">13.1. </span>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This notebook goes over the procedure to locate and download 30 meter resolution
Landsat and Sentinel data using NASA’s Harmonized Landsat and Sentinel-2  dataset.
These two satellites have very similar radiometer bands, fly in similar orbits and
have similar resolutions and swath widths.  NASA (Landsat) and the European Space Agency (ESA)
have collaborated on a common dataset that gives corrected surface reflectivity and brightness
temperatures for the two satellites.</p>
</section>
<section id="overview-objectives">
<h2><span class="section-number">13.2. </span>Overview/objectives<a class="headerlink" href="#overview-objectives" title="Link to this heading">#</a></h2>
<p>In the first few sections, we’ll go over how to select a Landsat scene for a particular place and range of dates, and look at the true-color browse image.  This image is available as jpg file without having to
authenticate with an earthdata id.</p>
<p>Then we’ll download a band 5, near-infrared geotif file, where tif stands for “tagged image format”.  Here is the <a class="reference external" href="https://en.wikipedia.org/wiki/TIFF">tif wikipedia article</a>. Unlike the jpg format, tif files don’t use lossy compression, and contain arbitrary metadata about the image.</p>
<p>Python modules introduced below:</p>
<ul class="simple">
<li><p>earthaccess, to send credentials to NASA</p></li>
<li><p>pystac_client, to search the image catalog for satellites, locations and dates</p></li>
<li><p>rioxarray, to read the tif image into memory and store as an xarray.DataArray object</p></li>
<li><p>xarray.DataArray, to access the metadata, make histograms and image plots</p></li>
<li><p>matplotlib.Normalize, to enhance image contrast for plotting specific ranges of reflectivities</p></li>
</ul>
<p>We’ll go into more detail on xarray and matplotlib/cartopy in future notebooks.</p>
<p>By the end of this notebook you should have a saved tif file of your landsat, band 5 image, and a good idea of what the reflective patterns of the image are.</p>
</section>
<section id="installation">
<h2><span class="section-number">13.3. </span>Installation<a class="headerlink" href="#installation" title="Link to this heading">#</a></h2>
<p>This notebook requires three additions to the a301 environment.  To install them, do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="n">earthaccess</span> <span class="n">pystac</span><span class="o">-</span><span class="n">client</span> <span class="n">shapely</span>
</pre></div>
</div>
</section>
<section id="authentication">
<h2><span class="section-number">13.4. </span>Authentication<a class="headerlink" href="#authentication" title="Link to this heading">#</a></h2>
<p>To get NASA to give you your image, you’ll need your username and password that you created at <a class="reference external" href="https://urs.earthdata.nasa.gov">https://urs.earthdata.nasa.gov/</a></p>
<p>You need to authenticate as described in: <a class="reference external" href="https://earthaccess.readthedocs.io/en/latest/howto/authenticate/">https://earthaccess.readthedocs.io/en/latest/howto/authenticate</a></p>
<p>The following steps create a <code class="docutils literal notranslate"><span class="pre">~/.netrc</span></code> file, which  keeps your username and password for future use:</p>
<ol class="arabic simple">
<li><p>open a terminal and activate the a301 environment</p></li>
<li><p>type <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-i</span></code> to get an interactive python session</p></li>
<li><p>type <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">earthaccess</span></code></p></li>
<li><p>type <code class="docutils literal notranslate"><span class="pre">auth</span> <span class="pre">=</span> <span class="pre">earthaccess.login(strategy=&quot;interactive&quot;,</span> <span class="pre">persist=True)</span></code> to create an authorization object and write the information into a netrc file for future reference.</p></li>
</ol>
<p>Then the next time you need to download or search HLS data you should just be able to do:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">earthaccess</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">earthaccess</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;netrc&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/phil/mini310/envs/a301/lib/python3.13/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">auth</span><span class="o">.</span><span class="n">authenticated</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>and your credentials will be read in from the netrc file.</p>
<p>You can search the catalog without logging in, but once you ask for data, the earthaccess object will write a new file called “cookies.txt” in the directory  you started jupyterlab in.</p>
</section>
<section id="doing-an-image-search-using-pystac-client">
<h2><span class="section-number">13.5. </span>Doing an image search using pystac_client<a class="headerlink" href="#doing-an-image-search-using-pystac-client" title="Link to this heading">#</a></h2>
<p>STAC is an acronym for “Spatio-temporal asset catalog”, which is a standard way of cataloging
GIS resources in the cloud.  A STAC catalog hold metadata, including web addresses, for geotiff
files like those uploaded by the <a class="reference external" href="https://www.earthdata.nasa.gov/learn/articles/hls-cloud-efforts">NASA harmonized landsat-sentinel project</a> (HLS) to Amazon Web Services.</p>
<p>We get the url for the stac catalog from the “Common Metadata Repository” stored on at <a class="reference external" href="https://nasa-openscapes.github.io/2021-Cloud-Hackathon/tutorials/02_Data_Discovery_CMR-STAC_API.html">NASA CMR page</a>. The HLS project catalog is called “LPCLOUD”  (for land processes cloud and is available at <a class="reference external" href="https://cmr.earthdata.nasa.gov/stac/LPCLOUD">https://cmr.earthdata.nasa.gov/stac/LPCLOUD</a>.  This is called a “stac endpoint” and will receive
and process requests sent to it by the pystac Client.</p>
<p>We’ll also need the <a class="reference external" href="https://towardsdatascience.com/geospatial-adventures-step-1-shapely-e911e4f86361">shapely</a> library to specify a point on the earth that we want to be included in our search. In addition, we need to specify a date range to search.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w">  </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">copy</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">rioxarray</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pystac_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Point</span>
</pre></div>
</div>
</div>
</div>
<p>Use shapely to create a point object holding the location of UBC.  Also create a datetime object showing the range of days you’re interested in searching for images.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hls_lon</span><span class="p">,</span> <span class="n">hls_lat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">58.3816</span><span class="p">,</span> <span class="o">-</span><span class="mf">34.607</span>
<span class="n">center_point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">hls_lon</span><span class="p">,</span> <span class="n">hls_lat</span><span class="p">)</span>
<span class="n">june_2015</span> <span class="o">=</span> <span class="s2">&quot;2015-01-01/2015-12-31&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># connect to the STAC endpoint</span>
<span class="n">cmr_api_url</span> <span class="o">=</span> <span class="s2">&quot;https://cmr.earthdata.nasa.gov/stac/LPCLOUD&quot;</span> 
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cmr_api_url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="set-up-the-search">
<h3><span class="section-number">13.5.1. </span>set up the search<a class="headerlink" href="#set-up-the-search" title="Link to this heading">#</a></h3>
<p>The pystac client object takes the search parameters as the following keywords:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="n">collections</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;HLSL30.v2.0&quot;</span><span class="p">],</span>
    <span class="n">intersects</span><span class="o">=</span><span class="n">center_point</span><span class="p">,</span>
    <span class="n">datetime</span><span class="o">=</span> <span class="n">june_2015</span>
<span class="p">)</span> 
<span class="c1"># uncomment below to see gory details</span>
<span class="c1"># help(search)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-the-metadata-for-search-items">
<h3><span class="section-number">13.5.2. </span>get the metadata for search items<a class="headerlink" href="#get-the-metadata-for-search-items" title="Link to this heading">#</a></h3>
<p>This search should find 4 scenes – 2 of which have 4% cloud cover.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lissearch</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">lissearch</span>

<span class="ne">NameError</span>: name &#39;lissearch&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">item_collection</span><span class="p">()</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">the_scene</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="si">{</span><span class="n">index</span><span class="si">=}</span><span class="se">\n</span><span class="s2">properties: </span><span class="si">{</span><span class="n">the_scene</span><span class="o">.</span><span class="n">properties</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># items</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>index=0
properties: {&#39;datetime&#39;: &#39;2015-01-04T13:44:40.563Z&#39;, &#39;eo:cloud_cover&#39;: 26, &#39;start_datetime&#39;: &#39;2015-01-04T13:44:40.563Z&#39;, &#39;end_datetime&#39;: &#39;2015-01-04T13:45:04.513Z&#39;}


index=1
properties: {&#39;datetime&#39;: &#39;2015-01-20T13:44:36.683Z&#39;, &#39;eo:cloud_cover&#39;: 57, &#39;start_datetime&#39;: &#39;2015-01-20T13:44:36.683Z&#39;, &#39;end_datetime&#39;: &#39;2015-01-20T13:45:00.633Z&#39;}


index=2
properties: {&#39;datetime&#39;: &#39;2015-02-05T13:44:33.322Z&#39;, &#39;eo:cloud_cover&#39;: 73, &#39;start_datetime&#39;: &#39;2015-02-05T13:44:33.322Z&#39;, &#39;end_datetime&#39;: &#39;2015-02-05T13:44:57.281Z&#39;}


index=3
properties: {&#39;datetime&#39;: &#39;2015-02-21T13:44:26.628Z&#39;, &#39;eo:cloud_cover&#39;: 78, &#39;start_datetime&#39;: &#39;2015-02-21T13:44:26.628Z&#39;, &#39;end_datetime&#39;: &#39;2015-02-21T13:44:50.583Z&#39;}


index=4
properties: {&#39;datetime&#39;: &#39;2015-03-09T13:44:17.620Z&#39;, &#39;eo:cloud_cover&#39;: 54, &#39;start_datetime&#39;: &#39;2015-03-09T13:44:17.620Z&#39;, &#39;end_datetime&#39;: &#39;2015-03-09T13:44:41.571Z&#39;}


index=5
properties: {&#39;datetime&#39;: &#39;2015-04-10T13:44:00.317Z&#39;, &#39;eo:cloud_cover&#39;: 75, &#39;start_datetime&#39;: &#39;2015-04-10T13:44:00.317Z&#39;, &#39;end_datetime&#39;: &#39;2015-04-10T13:44:24.263Z&#39;}


index=6
properties: {&#39;datetime&#39;: &#39;2015-04-26T13:43:56.115Z&#39;, &#39;eo:cloud_cover&#39;: 15, &#39;start_datetime&#39;: &#39;2015-04-26T13:43:56.115Z&#39;, &#39;end_datetime&#39;: &#39;2015-04-26T13:44:20.061Z&#39;}


index=7
properties: {&#39;datetime&#39;: &#39;2015-05-12T13:43:40.104Z&#39;, &#39;eo:cloud_cover&#39;: 14, &#39;start_datetime&#39;: &#39;2015-05-12T13:43:40.104Z&#39;, &#39;end_datetime&#39;: &#39;2015-05-12T13:44:04.063Z&#39;}


index=8
properties: {&#39;datetime&#39;: &#39;2015-05-28T13:43:42.361Z&#39;, &#39;eo:cloud_cover&#39;: 35, &#39;start_datetime&#39;: &#39;2015-05-28T13:43:42.361Z&#39;, &#39;end_datetime&#39;: &#39;2015-05-28T13:44:06.316Z&#39;}


index=9
properties: {&#39;datetime&#39;: &#39;2015-06-13T13:43:54.456Z&#39;, &#39;eo:cloud_cover&#39;: 38, &#39;start_datetime&#39;: &#39;2015-06-13T13:43:54.456Z&#39;, &#39;end_datetime&#39;: &#39;2015-06-13T13:44:18.415Z&#39;}


index=10
properties: {&#39;datetime&#39;: &#39;2015-07-15T13:44:10.994Z&#39;, &#39;eo:cloud_cover&#39;: 11, &#39;start_datetime&#39;: &#39;2015-07-15T13:44:10.994Z&#39;, &#39;end_datetime&#39;: &#39;2015-07-15T13:44:34.953Z&#39;}


index=11
properties: {&#39;datetime&#39;: &#39;2015-08-16T13:44:21.344Z&#39;, &#39;eo:cloud_cover&#39;: 77, &#39;start_datetime&#39;: &#39;2015-08-16T13:44:21.344Z&#39;, &#39;end_datetime&#39;: &#39;2015-08-16T13:44:45.295Z&#39;}


index=12
properties: {&#39;datetime&#39;: &#39;2015-09-01T13:44:26.648Z&#39;, &#39;eo:cloud_cover&#39;: 12, &#39;start_datetime&#39;: &#39;2015-09-01T13:44:26.648Z&#39;, &#39;end_datetime&#39;: &#39;2015-09-01T13:44:50.599Z&#39;}


index=13
properties: {&#39;datetime&#39;: &#39;2015-09-17T13:44:35.007Z&#39;, &#39;eo:cloud_cover&#39;: 4, &#39;start_datetime&#39;: &#39;2015-09-17T13:44:35.007Z&#39;, &#39;end_datetime&#39;: &#39;2015-09-17T13:44:58.966Z&#39;}


index=14
properties: {&#39;datetime&#39;: &#39;2015-10-03T13:44:39.133Z&#39;, &#39;eo:cloud_cover&#39;: 22, &#39;start_datetime&#39;: &#39;2015-10-03T13:44:39.133Z&#39;, &#39;end_datetime&#39;: &#39;2015-10-03T13:45:03.083Z&#39;}


index=15
properties: {&#39;datetime&#39;: &#39;2015-10-19T13:44:40.507Z&#39;, &#39;eo:cloud_cover&#39;: 99, &#39;start_datetime&#39;: &#39;2015-10-19T13:44:40.507Z&#39;, &#39;end_datetime&#39;: &#39;2015-10-19T13:45:04.466Z&#39;}


index=16
properties: {&#39;datetime&#39;: &#39;2015-11-04T13:44:44.958Z&#39;, &#39;eo:cloud_cover&#39;: 4, &#39;start_datetime&#39;: &#39;2015-11-04T13:44:44.958Z&#39;, &#39;end_datetime&#39;: &#39;2015-11-04T13:45:08.908Z&#39;}


index=17
properties: {&#39;datetime&#39;: &#39;2015-11-20T13:44:46.546Z&#39;, &#39;eo:cloud_cover&#39;: 10, &#39;start_datetime&#39;: &#39;2015-11-20T13:44:46.546Z&#39;, &#39;end_datetime&#39;: &#39;2015-11-20T13:45:10.497Z&#39;}


index=18
properties: {&#39;datetime&#39;: &#39;2015-12-06T13:44:45.826Z&#39;, &#39;eo:cloud_cover&#39;: 7, &#39;start_datetime&#39;: &#39;2015-12-06T13:44:45.826Z&#39;, &#39;end_datetime&#39;: &#39;2015-12-06T13:45:09.785Z&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-the-assets-for-scene-1-june-14-2015">
<h3><span class="section-number">13.5.3. </span>Get the assets for scene 1 (June 14, 2015)<a class="headerlink" href="#get-the-assets-for-scene-1-june-14-2015" title="Link to this heading">#</a></h3>
<p>Once we decide on the scene, we can access its assets.  It contains the href (url) for
each of the landsat bands (except Band 8) – here are their wavelengths:  <a class="reference external" href="https://landsat.gsfc.nasa.gov/satellites/landsat-8/landsat-8-bands/">Landsat Bands</a></p>
<p>What happened to band 8? It is in a wavelength range that is only measured by the Sentinel MSI scanner, not the Landsat OLI scanner.  The channel comparisons are given here:
<a class="reference external" href="https://lpdaac.usgs.gov/data/get-started-data/collection-overview/missions/harmonized-landsat-sentinel-2-hls-overview/">harmonized channels</a></p>
<p>If we had found a Sentinel image instead, we would be missing the thermal channels in Landsat bands 10 and 11.</p>
<p>There are also geotiffs for the</p>
<ul class="simple">
<li><p>Solar Azimuth Angle (SAA)</p></li>
<li><p>Solar Zenith Angle (SZA)</p></li>
<li><p>Sensor Azimuth Angle (VAA)</p></li>
<li><p>Sensor Zenith Angle (VZA)</p></li>
</ul>
<p>and a jpg image file called ‘browse’ which is a 1000 x 1000 pixel true color image for the scene.  This image is created by mapping bands 2, 3 and 4 to the blue, green and red values in the browse jpg image file file.</p>
<p>The filenames below show that the June 14 scene was taken by Landsat – Landsat filenames begin with HLS.L30, Sentinel with HLS.S30.  The number 30 is the pixel size in meters:  30 meters high by 30 meters wide</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hls_scene</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span>
<span class="n">hls_scene</span><span class="o">.</span><span class="n">assets</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;browse&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.jpg&gt;,
 &#39;thumbnail_0&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.jpg&gt;,
 &#39;thumbnail_1&#39;: &lt;Asset href=s3://lp-prod-public/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.jpg&gt;,
 &#39;B01&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.B01.tif&gt;,
 &#39;B02&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.B02.tif&gt;,
 &#39;B10&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.B10.tif&gt;,
 &#39;B06&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.B06.tif&gt;,
 &#39;B09&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.B09.tif&gt;,
 &#39;B05&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.B05.tif&gt;,
 &#39;SAA&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.SAA.tif&gt;,
 &#39;SZA&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.SZA.tif&gt;,
 &#39;B03&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.B03.tif&gt;,
 &#39;VZA&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.VZA.tif&gt;,
 &#39;B07&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.B07.tif&gt;,
 &#39;B04&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.B04.tif&gt;,
 &#39;Fmask&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.Fmask.tif&gt;,
 &#39;VAA&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.VAA.tif&gt;,
 &#39;B11&#39;: &lt;Asset href=https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.B11.tif&gt;,
 &#39;metadata&#39;: &lt;Asset href=https://cmr.earthdata.nasa.gov/search/concepts/G2225196138-LPCLOUD.xml&gt;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-and-display-the-true-color-browse-image">
<h3><span class="section-number">13.5.4. </span>Download and display the true-color browse image<a class="headerlink" href="#download-and-display-the-true-color-browse-image" title="Link to this heading">#</a></h3>
<p>You can see the browse image by clicking on the asset href above. We can also use rioxarray to download the browse image from its url.  The browse image is stored as a red green blue jpg file:  <a class="reference external" href="https://en.wikipedia.org/wiki/JPEG">wikipedia page on jpg</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hls_browse</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">hls_scene</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;browse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">href</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/phil/mini310/envs/a301/lib/python3.13/site-packages/rioxarray/_io.py:1136: NotGeoreferencedWarning: Dataset has no geotransform, gcps, or rpcs. The identity matrix will be returned.
  warnings.warn(str(rio_warning.message), type(rio_warning.message))  # type: ignore
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">hls_browse</span></code> is an <a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.DataArray.htm">xarray DataArray</a>.  In this case it’s a simple 3 dimensional array with shape (3,1000,1000) holding the integer brightness levels (0-255), along with x,y values for each pixel.   These are just values of the pixel centers between 0-1000, since the browse image has no coordinate reference system attached.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">hls_browse</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xarray.core.dataarray.DataArray
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hls_browse</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1f1f1f;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "►";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "▼";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (band: 3, y: 1000, x: 1000)&gt; Size: 3MB
[3000000 values with dtype=uint8]
Coordinates:
  * band         (band) int64 24B 1 2 3
  * x            (x) float64 8kB 0.5 1.5 2.5 3.5 4.5 ... 996.5 997.5 998.5 999.5
  * y            (y) float64 8kB 0.5 1.5 2.5 3.5 4.5 ... 996.5 997.5 998.5 999.5
    spatial_ref  int64 8B 0
Attributes:
    scale_factor:  1.0
    add_offset:    0.0</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>band</span>: 3</li><li><span class='xr-has-index'>y</span>: 1000</li><li><span class='xr-has-index'>x</span>: 1000</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-9310c4d2-8f8e-476a-8330-e33170d6d801' class='xr-array-in' type='checkbox' checked><label for='section-9310c4d2-8f8e-476a-8330-e33170d6d801' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>...</span></div><div class='xr-array-data'><pre>[3000000 values with dtype=uint8]</pre></div></div></li><li class='xr-section-item'><input id='section-dbaf1a80-a80b-4820-b495-ea8dda3fe113' class='xr-section-summary-in' type='checkbox'  checked><label for='section-dbaf1a80-a80b-4820-b495-ea8dda3fe113' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>band</span></div><div class='xr-var-dims'>(band)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3</div><input id='attrs-2b837754-3634-4297-9d63-35c92de57500' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2b837754-3634-4297-9d63-35c92de57500' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d77c7ed9-66b7-4108-8386-0868c886c333' class='xr-var-data-in' type='checkbox'><label for='data-d77c7ed9-66b7-4108-8386-0868c886c333' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5 1.5 2.5 ... 997.5 998.5 999.5</div><input id='attrs-80806431-0417-4042-b3d8-ad2d87edbf7e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-80806431-0417-4042-b3d8-ad2d87edbf7e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-98646a02-f6d9-4852-b21b-e3fdbbb7697d' class='xr-var-data-in' type='checkbox'><label for='data-98646a02-f6d9-4852-b21b-e3fdbbb7697d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([5.000e-01, 1.500e+00, 2.500e+00, ..., 9.975e+02, 9.985e+02, 9.995e+02],
      shape=(1000,))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5 1.5 2.5 ... 997.5 998.5 999.5</div><input id='attrs-cb39d1a4-2d2d-45ac-b55a-6edceef91423' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-cb39d1a4-2d2d-45ac-b55a-6edceef91423' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-998063c1-9f13-4650-b534-060ab6e7f27d' class='xr-var-data-in' type='checkbox'><label for='data-998063c1-9f13-4650-b534-060ab6e7f27d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([5.000e-01, 1.500e+00, 2.500e+00, ..., 9.975e+02, 9.985e+02, 9.995e+02],
      shape=(1000,))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>spatial_ref</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-52b2eb82-34b8-45fd-ab4a-fbb7b4319a13' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-52b2eb82-34b8-45fd-ab4a-fbb7b4319a13' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-960bb277-ec99-402f-b71c-5b8a47f4224e' class='xr-var-data-in' type='checkbox'><label for='data-960bb277-ec99-402f-b71c-5b8a47f4224e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>GeoTransform :</span></dt><dd>0.0 1.0 0.0 0.0 0.0 1.0</dd></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-fb032bca-b8f4-4c5b-81ab-27e26e812f3e' class='xr-section-summary-in' type='checkbox'  ><label for='section-fb032bca-b8f4-4c5b-81ab-27e26e812f3e' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>band</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-004c44c0-730c-4619-93cc-acbca11fbcfa' class='xr-index-data-in' type='checkbox'/><label for='index-004c44c0-730c-4619-93cc-acbca11fbcfa' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1, 2, 3], dtype=&#x27;int64&#x27;, name=&#x27;band&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-28e6ff2b-1afe-4f1b-a25b-2892e4dc9226' class='xr-index-data-in' type='checkbox'/><label for='index-28e6ff2b-1afe-4f1b-a25b-2892e4dc9226' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([  0.5,   1.5,   2.5,   3.5,   4.5,   5.5,   6.5,   7.5,   8.5,   9.5,
       ...
       990.5, 991.5, 992.5, 993.5, 994.5, 995.5, 996.5, 997.5, 998.5, 999.5],
      dtype=&#x27;float64&#x27;, name=&#x27;x&#x27;, length=1000))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-fe3c5e1b-9ab9-485f-a13e-4b80c32f2a56' class='xr-index-data-in' type='checkbox'/><label for='index-fe3c5e1b-9ab9-485f-a13e-4b80c32f2a56' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([  0.5,   1.5,   2.5,   3.5,   4.5,   5.5,   6.5,   7.5,   8.5,   9.5,
       ...
       990.5, 991.5, 992.5, 993.5, 994.5, 995.5, 996.5, 997.5, 998.5, 999.5],
      dtype=&#x27;float64&#x27;, name=&#x27;y&#x27;, length=1000))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-33f1dc46-7eef-4ce2-9f32-104fd44239f1' class='xr-section-summary-in' type='checkbox'  checked><label for='section-33f1dc46-7eef-4ce2-9f32-104fd44239f1' class='xr-section-summary' >Attributes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>scale_factor :</span></dt><dd>1.0</dd><dt><span>add_offset :</span></dt><dd>0.0</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>and we can plot it using imshow</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">hls_browse</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="s1">&#39;upper&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;June 14, 2015, Landsat 8&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8f26935a676d974c19fbc01a245f01ac5ca92fe9886ddc255ecaeb9ad82be9e7.png" src="../../_images/8f26935a676d974c19fbc01a245f01ac5ca92fe9886ddc255ecaeb9ad82be9e7.png" />
</div>
</div>
</section>
</section>
<section id="working-with-the-band5-geotiff">
<h2><span class="section-number">13.6. </span>Working with the Band5 geotiff<a class="headerlink" href="#working-with-the-band5-geotiff" title="Link to this heading">#</a></h2>
<p>Landsat Band5 in the near-infrared spans wavelengths between  0.845–0.885 <span class="math notranslate nohighlight">\(\mu m\)</span> which are invisible to the human eye. This is a wavelength region where vegetation is very reflective,
because the leaves want to absorb red photons for photosynthesis and reflect slightly longer near-ir photons so they don’t get absorbed and
raise the leaf temperature.  This difference between red (Band4) and near-infrared (Band 5) is called the <a class="reference external" href="https://agrio.app/Red-Edge-reflectance-monitoring-for-early-plant-stress-detection/">“red edge”</a>.</p>
<p>If you have managed to get your earthdata login into the <code class="docutils literal notranslate"><span class="pre">~/.netrc</span></code> file you should be able to download and save band 5 as shown below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">band_name</span><span class="o">=</span><span class="s2">&quot;B05&quot;</span>
<span class="n">hls_scene</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span><span class="o">.</span><span class="n">href</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T21HUB.2015340T134445.v2.0/HLS.L30.T21HUB.2015340T134445.v2.0.B05.tif&#39;
</pre></div>
</div>
</div>
</div>
<section id="set-the-cookie-file-name-as-an-environmental-variable">
<h3><span class="section-number">13.6.1. </span>set the cookie file name as an environmental variable<a class="headerlink" href="#set-the-cookie-file-name-as-an-environmental-variable" title="Link to this heading">#</a></h3>
<p>We got the browse image for free, but the actual bands require authorization. The nasa earthdata site will put an encrypted token into the file <code class="docutils literal notranslate"><span class="pre">cookies.txt</span></code> in the current directory (‘.’) when we ask for band data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GDAL_HTTP_COOKIEFILE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./cookies.txt&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GDAL_HTTP_COOKIEJAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./cookies.txt&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-the-band-5-raster">
<h3><span class="section-number">13.6.2. </span>Read the band 5 raster<a class="headerlink" href="#read-the-band-5-raster" title="Link to this heading">#</a></h3>
<p>The next cell reads in the raster.  By setting <code class="docutils literal notranslate"><span class="pre">masked=True</span></code> we are telling rasterio to look up the <code class="docutils literal notranslate"><span class="pre">_FillValue</span></code> tag in the
geotiff, and replace all pixels that have that value to <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>.</p>
<section id="use-a-local-file-if-available">
<h4><span class="section-number">13.6.2.1. </span>Use a local file if available<a class="headerlink" href="#use-a-local-file-if-available" title="Link to this heading">#</a></h4>
<p>This step is the one that requires authentication.  NASA counts the number of downloads your account makes in a day, and
will deny access if you exceed a threshold (about 50 downloads).  At the bottom of the notebook in section <a class="reference internal" href="#sec-writeout"><span class="std std-ref">Write out the raster as a geotiff</span></a> we write band 5 to disk if the variable <code class="docutils literal notranslate"><span class="pre">writeit</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.  If you want to use that file instead, set the variable <code class="docutils literal notranslate"><span class="pre">from_disk</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;repos/a301/satdata/landsat&#39;</span>
<span class="n">band_name</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">data_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">disk_file</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;hls_landsat8_</span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2">.tif&quot;</span>
<span class="n">has_file</span> <span class="o">=</span> <span class="n">disk_file</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

<span class="n">from_disk</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">from_disk</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_file</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;can&#39;t find </span><span class="si">{</span><span class="n">disk_file</span><span class="si">}</span><span class="s2">, rerun with from_disk=False and writeit=True&quot;</span><span class="p">)</span> 
    <span class="n">hls_band5</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">disk_file</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># go to NASA</span>
    <span class="n">hls_band5</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">hls_scene</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="s1">&#39;B05&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">href</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">OSError</span><span class="g g-Whitespace">                                   </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">line</span> <span class="mi">10</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="k">if</span> <span class="n">from_disk</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">has_file</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">10</span>         <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;can&#39;t find </span><span class="si">{</span><span class="n">disk_file</span><span class="si">}</span><span class="s2">, rerun with from_disk=False and writeit=True&quot;</span><span class="p">)</span> 
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">hls_band5</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">disk_file</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="c1"># go to NASA</span>

<span class="ne">OSError</span>: can&#39;t find /Users/phil/repos/a301/satdata/landsat/hls_landsat8_5.tif, rerun with from_disk=False and writeit=True
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="list-all-attributes">
<h3><span class="section-number">13.6.3. </span>List all attributes<a class="headerlink" href="#list-all-attributes" title="Link to this heading">#</a></h3>
<p>Unlike the browse image, the actual band 5 tif has metadata.  xarray DataArray objects store metadata as “attributes”.  Here are all the attributes we fetched from the tif file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hls_band5</span><span class="o">.</span><span class="n">attrs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">hls_band5</span><span class="o">.</span><span class="n">attrs</span>

<span class="ne">NameError</span>: name &#39;hls_band5&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The most important are the coordinate reference system for the image (UTM zone 10N), the coordinates of the upper left corner (not the center) (ULX, ULY), the pixel size (SPATIAL_RESOLUTION), cloud_coverage (4%), and the scale_factor we need to multiply by to get surface refectance from the packed data values.</p>
<p>The DataArray also has three indexes, the first is just the number 1 (only 1 band in the tif), the next 2 are the x,y values of the center of each pixel in UTM 10N coordiates. Note that the  y array gets smaller as the index increases – the image is scanned from top to bottom.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hls_band5</span><span class="o">.</span><span class="n">indexes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">hls_band5</span><span class="o">.</span><span class="n">indexes</span>

<span class="ne">NameError</span>: name &#39;hls_band5&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="machine-readable-crs">
<h3><span class="section-number">13.6.4. </span>Machine readable crs<a class="headerlink" href="#machine-readable-crs" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">HORIZONTAL_CS_NAME</span></code> attribute is for humans.  To use the image CRS with a program like cartopy we need a more detailed version.  This is supplied by an accessor function added to xarray by rioxarray, with outputs the crs in “well known text (WKT)” format:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hls_band5</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">hls_band5</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span>

<span class="ne">NameError</span>: name &#39;hls_band5&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="image-coverage">
<h3><span class="section-number">13.6.5. </span>Image  coverage<a class="headerlink" href="#image-coverage" title="Link to this heading">#</a></h3>
<p>Here are two ways of finding the image width in km.  The first way gives 109.77 km</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="n">hls_band5</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hls_band5</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="p">((</span><span class="n">hls_band5</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hls_band5</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;hls_band5&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The second gives 109.80 km.</p>
<section id="explain-why-the-two-estimates-are-correct-but-different">
<h4><span class="section-number">13.6.5.1. </span>Explain why the two estimates are correct but different.<a class="headerlink" href="#explain-why-the-two-estimates-are-correct-but-different" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hls_band5</span><span class="o">.</span><span class="n">NCOLS</span><span class="o">*</span><span class="mf">30.</span><span class="o">/</span><span class="mf">1000.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">hls_band5</span><span class="o">.</span><span class="n">NCOLS</span><span class="o">*</span><span class="mf">30.</span><span class="o">/</span><span class="mf">1000.</span>

<span class="ne">NameError</span>: name &#39;hls_band5&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="scaling-the-image">
<h3><span class="section-number">13.6.6. </span>Scaling the image<a class="headerlink" href="#scaling-the-image" title="Link to this heading">#</a></h3>
<p>The cell below removes the useless unit index and converts the image from (1,3660,3660) to (3660,3660), then scales the array.
Note that by doing arithemetic on the image, we lose all the metadata, but we keep the indexes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hls_raster</span> <span class="o">=</span> <span class="n">hls_band5</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">hls_raster</span> <span class="o">=</span> <span class="n">hls_raster</span><span class="o">*</span><span class="n">hls_band5</span><span class="o">.</span><span class="n">scale_factor</span>
<span class="n">hls_raster</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">hls_raster</span><span class="o">.</span><span class="n">indexes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">hls_raster</span> <span class="o">=</span> <span class="n">hls_band5</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">hls_raster</span> <span class="o">=</span> <span class="n">hls_raster</span><span class="o">*</span><span class="n">hls_band5</span><span class="o">.</span><span class="n">scale_factor</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">hls_raster</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">hls_raster</span><span class="o">.</span><span class="n">indexes</span>

<span class="ne">NameError</span>: name &#39;hls_band5&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hls_raster</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">hls_band5</span><span class="o">.</span><span class="n">attrs</span>
<span class="n">hls_raster</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">23</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">hls_raster</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">hls_band5</span><span class="o">.</span><span class="n">attrs</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">hls_raster</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;hls_band5&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="histogram-the-raster">
<h3><span class="section-number">13.6.7. </span>Histogram the raster<a class="headerlink" href="#histogram-the-raster" title="Link to this heading">#</a></h3>
<p>Make sure the scaled band5 reflectance is in the range 0-1</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hls_raster</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">24</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">hls_raster</span>

<span class="ne">NameError</span>: name &#39;hls_raster&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#hls_raster.plot.hist();</span>
<span class="c1"># ls_band5.plot.hist()</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="c1">#plt.hist(hls_raster.data.flat)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-it-using-a-grey-palette">
<h3><span class="section-number">13.6.8. </span>Plot it using a grey palette<a class="headerlink" href="#plot-it-using-a-grey-palette" title="Link to this heading">#</a></h3>
<p>We can use the Normalize object to adjust the maximum range we want to assign colors to.  In this case,
we don’t want to waste colors on the very few pixels with reflectances higher than 0.8.  We’ll use a grey scale colormap.  Note that the DataArray object
knows how to use the x and y indexes to label the axis tick marks in map coordinates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pal</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">))</span>
<span class="n">pal</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="s2">&quot;0.75&quot;</span><span class="p">)</span>  <span class="c1"># color 75% grey np.nan cells</span>
<span class="n">pal</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>  <span class="c1"># color cells &gt; vmax red</span>
<span class="n">pal</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>  <span class="c1"># color cells &lt; vmin black</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1">#anything under this is colored black</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="mf">0.8</span>  <span class="c1">#anything over this is colored white</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">Normalize</span>
<span class="n">the_norm</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">hls_raster</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pal</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">the_norm</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Landsat band </span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">hls_raster</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pal</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">the_norm</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Landsat band </span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;hls_raster&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/4091aeba233d682cdfb328838dc3ec05f736add8256f1fdac11eaa245cceaf9e.png" src="../../_images/4091aeba233d682cdfb328838dc3ec05f736add8256f1fdac11eaa245cceaf9e.png" />
</div>
</div>
</section>
<section id="write-out-the-raster-as-a-geotiff">
<span id="sec-writeout"></span><h3><span class="section-number">13.6.9. </span>Write out the raster as a geotiff<a class="headerlink" href="#write-out-the-raster-as-a-geotiff" title="Link to this heading">#</a></h3>
<p>Save the original tif to disk so you don’t need to go back to NASA</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">writeit</span><span class="o">=</span><span class="kc">False</span>
<span class="k">if</span> <span class="n">writeit</span><span class="p">:</span>
    <span class="n">hls_band5</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">to_raster</span><span class="p">(</span><span class="n">disk_file</span><span class="p">)</span>
    <span class="c1">#check if write worked</span>
    <span class="n">hls_band5</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">disk_file</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;checking read, here is the crs: </span><span class="si">{</span><span class="n">hls_band5</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="what-s-next">
<h2><span class="section-number">13.7. </span>What’s next<a class="headerlink" href="#what-s-next" title="Link to this heading">#</a></h2>
<p>Now that we can get landsat and sentinel scenes, we need to be able to
subset to a particular part of the image, apply the cloud mask to remove cloudy
pixels and use channel ratios to infer surface properties.  That’s the topic for the
next few notebooks.</p>
<section id="for-monday-s-class">
<h3><span class="section-number">13.7.1. </span>For Monday’s class<a class="headerlink" href="#for-monday-s-class" title="Link to this heading">#</a></h3>
<p>For Monday, copy this notebook and edit it to download and save a new tif containing band 4 (red) for your location.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python<span class="w"> </span>--version
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Python 3.13.1
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/week2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="cartopy_mapping_vancouver.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">12. </span>Mapping Vancouver with cartopy</p>
      </div>
    </a>
    <a class="right-next"
       href="../week3/map_landsat.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">14. </span>Mapping the landsat scene</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">13.1. Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview-objectives">13.2. Overview/objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">13.3. Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#authentication">13.4. Authentication</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#doing-an-image-search-using-pystac-client">13.5. Doing an image search using pystac_client</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-the-search">13.5.1. set up the search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-metadata-for-search-items">13.5.2. get the metadata for search items</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-assets-for-scene-1-june-14-2015">13.5.3. Get the assets for scene 1 (June 14, 2015)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-display-the-true-color-browse-image">13.5.4. Download and display the true-color browse image</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-the-band5-geotiff">13.6. Working with the Band5 geotiff</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-the-cookie-file-name-as-an-environmental-variable">13.6.1. set the cookie file name as an environmental variable</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-band-5-raster">13.6.2. Read the band 5 raster</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-local-file-if-available">13.6.2.1. Use a local file if available</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#list-all-attributes">13.6.3. List all attributes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-readable-crs">13.6.4. Machine readable crs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#image-coverage">13.6.5. Image  coverage</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#explain-why-the-two-estimates-are-correct-but-different">13.6.5.1. Explain why the two estimates are correct but different.</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling-the-image">13.6.6. Scaling the image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram-the-raster">13.6.7. Histogram the raster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-it-using-a-grey-palette">13.6.8. Plot it using a grey palette</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#write-out-the-raster-as-a-geotiff">13.6.9. Write out the raster as a geotiff</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-next">13.7. What’s next</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-monday-s-class">13.7.1. For Monday’s class</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Philip Austin
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>